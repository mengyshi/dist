"use strict";$(function(){var t;if(localStorage.getItem("loginmessage")){var e=JSON.parse(localStorage.getItem("loginmessage"));console.log("aa"),console.log(e.username),$(".nav-left em").text(e.username).css("color","rgb(229,0,75)"),t=e.token}else alert("您当前处于未登录状态！无法查看购物车中的内容！");function h(t,e,n){$.get("http://47.104.244.134:8080/cartupdate.do",{id:t,gid:e,num:n},function(t){console.log(t.msg)});for(var a=0,l=0;l<$(".perPrice").length;l++)console.log($(".perPrice").children().eq(l)),$(".perPrice").children().eq(l).html($(".perPrice").prev().find(".num").eq(l).val()*$(".price").eq(l).children().text());for(var r=0;r<$(".chk").length;r++)$(".chk").eq(r).prop("checked")&&(a+=Number($(".num").eq(r).val()*$(".price").eq(r).children().eq(0).text()));$("#total span:nth-child(2)").html(a)}$.get("http://47.104.244.134:8080/cartlist.do",{token:t},function(t){console.log(t);var e="";t.map(function(t){e+="<tr data-id="+t.id+" data-gid="+t.gid+' style="border-bottom:2px solid #cecece">\n\t\t\t\t\t<td><input type="checkbox" class="chk"/></td>\n\t\t\t\t\t<td><img src="'+t.goods.picurl+'"/></td>\n\t\t\t\t\t<td>'+t.goods.name+'</td>\n\t\t\t\t\t<td class="price"><span>'+t.goods.price+'</span>元</td>\n\t\t\t\t\t\n\t\t\t\t\t<td><input type="button" class="minus" style="width:14px" value="-"> <input type="text" class="num" value="'+t.count+'" style="width:30px;"/><input type="button" class="plus" style="width:14px" value="+"></td>\n\t\t\t\t\t<td class="perPrice"><span>'+t.goods.price*t.count+'</span>元</td>\n\t\t\t\t\t<td><input type="button" class="delBtn" value="删除"/></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t'}),$("#tb").html(e),$(".cart_no").eq(0).html($("tbody tr").length),$("#selectAll").click(function(){$(".chk").prop("checked",$("#selectAll").prop("checked")),h(),$("#count").html($(".chk:checked").length)}),$(".chk").click(function(){$(".chk:checked").length!=$(".chk").length?$("#selectAll").prop("checked",!1):$("#selectAll").prop("checked",!0),$("#count").html($(".chk:checked").length),h()});for(var n=function(t){o=1,l=$(".minus").eq(t).parent().parent().attr("data-id"),r=$(".minus").eq(t).parent().parent().attr("data-gid"),$(".plus").eq(t).click(function(){$(".plus").eq(t).prev().val(Number($(".plus").eq(t).prev().val())+1),h(l,r,o)})},a=0;a<$(".plus").length;a++){var l,r;n(a)}var c=function(n){o=1,$(".minus").eq(n).click(function(){var t=$(".minus").eq(n).parent().parent().attr("data-id"),e=$(".minus").eq(n).parent().parent().attr("data-gid");$(".minus").eq(n).next().val()<=1?(h(t,e,0),$(".minus").eq(n).parent().parent().remove(),$(".cart_no").eq(0).html($("tbody tr").length)):($(".minus").eq(n).next().val($(".minus").eq(n).next().val()-1),h(t,e,-o)),console.log(t,e,-o)})};for(a=0;a<$(".minus").length;a++){var o;c(a)}for(var i=[],d=0;d<=$(".num").length;d++){var s=$(".num").eq(d).val();i.push(s)}var p=function(a){$(".num").eq(a).change(function(){var t;console.log(a);var e=$(".num").eq(a).parent().parent().attr("data-id"),n=$(".num").eq(a).parent().parent().attr("data-gid");$(".num").eq(a).val($(".num").eq(a).val()),t=$(".num").eq(a).val(),console.log(i[a],t),h(e,n,t-i[a]),i[a]=t})};for(a=0;a<$(".num").length;a++)p(a);var u=function(t){$(".delBtn").eq(t).click(function(){console.log(this),h($(".delBtn").eq(t).parent().parent().attr("data-id"),$(".delBtn").eq(t).parent().parent().attr("data-gid"),0),$(this).parent().parent().remove()})};for(a=0;a<$(".delBtn").length;a++)u(a);$("#clearAll").click(function(){for(var t=0;t<=$("tbody tr").length;t++){h($("tbody tr").eq(t).attr("data-id"),$("tbody tr").eq(t).attr("data-gid"),0)}$("tbody tr").remove()})})});